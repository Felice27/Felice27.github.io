---
layout: post
title: Numerical Heating in PIC simulations
use_math: true
category: research
---

Particle-in-Cell Codes are prone to a phenomenon known as self-heating which results in energy not being conserved over the course of the simulation (need to explain why). This heating typically results in a linear gain of energy over time (source?). 

In the paper by Arber, the authors explore the different factors that contribute to numerical heating in EPOCH. In order to run a simulation with minimal error, we would want the cell size to be very small with respect to relevant length scales of the simulation. For a plasma, the relevant length scale is the Debye Length $\lambda_D$. If we define

\begin{equation}
  r \equiv \frac{\lambda_D}{\Delta x}
\end{equation}

then we would want $r \gg 1$. This paper, however, does not assume that. Additionally, using more macroparticles per cell and a higher order shape function would in general result in a more accurate simulation which would prevent the effects of heating. Also, the number density of particles in the simulation should affect the energy gain due to the change in the number of interactions of neighboring particles. Finally, the last consideration this paper makes is an option called *current smoothing* which can reduce the effect of numerical Cherenkov radiation. All of these considerations are summarized by the following formula (eq. 30 in the paper)

\begin{equation}
        \frac{d T_\text{eV}}{d t_\text{ps}} = \alpha_H \frac{n_{23}^{3/2} \Delta x_\text{nm}^2}{n_\text{ppc}} \label{eq:arberformula}
\end{equation}

where $\alpha_H$ is an empirically derived factor that depends on both the shape function and presence of current smoothing. Also, $n_{23}$ is the number density in units of $10^{23} \frac{1}{\text{cm}^3}

Here, I will attempt to reproduce the results of Figure 5 from the paper. There, they use a Top-hat shape function which results in $\alpha_H = 3000$ without current smoothing and $\alpha_H = 1000$ when smoothing is turned on. Initially, the plasma starts at a temperature of $T_0 = 100 $eV, number of particles per cell $n_{ppc} = 100$, and number density $n_{23} = 1$. This plasma is uniform in density and has a fixed number of cells in each dimension $N_i = 16$ and the simulation volume is varied by using different values of $r = {0.01, 0.1, 0.5, 0.8, 1.1}$ which correspond to cell sizes that are not resolved by the Debye Length. 

For this setup, the Debye Length can be computed from the formula from Chen (put reference here)

\begin{equation}
        \lambda_{D0} = 7430 (T_{eV}/n)^\frac{1}{2} = 7430 \sqrt{\frac{100}{1*10^{29}}} = 0.235 \text{nm}
\end{equation}

and since the Debye Length is proportional to the temperature, the Debye Length at a future time and temperature $T$ would be given by

\begin{equation}
    (\frac{\lambda_D}{\Delta x})^2 = \frac{\lambda_D^2}{\lambda_0^2} \frac{\lambda_{D0}^2}{\Delta x^2} = \frac{T}{T_0} (\frac{\lambda_{D0}}{\Delta x})^2 
\end{equation}

First, I compared the estimates by doing 2D simulations where my results are on the left and Arber's results are on the right. 

<img src="/osunotebook/research/images/elec_fig5.png" style="width: 50%;"/> <img src="/osunotebook/research/images/arber_fig5.PNG" style="width: 45%;"/>

The solid lines indicate current smoothing and the dashed lines indicate its absence. My simulations look qualitatively similar for values of {% raw %} $r = \color{blue}{0.5}, \color{green}{0.8}, \color{red}{1.1}$, but when $r = \color{cyan}{0.01}, \color{magenta}{0.1}$ {% endraw %}, my simulations have a much larger spike in the temperature gain from the beginning of the simulation. I decided to rerun the simulations in 1D below.

<img src="/osunotebook/research/images/elec_fig5_1D.png" style="width: 50%;"/> <img src="/osunotebook/research/images/arber_fig5.PNG" style="width: 45%;"/>

These 1D simulations show a slightly smaller increase in temperature over time and the line for {% raw %} $r = \color{magenta}{0.1}$ {% endraw %} now looks more accurate. 
Additionally, I also compared the heating estimates to compare the slope determined by eq. \eqref{eq:arberformula}. As an example, I have a graph displayed below that shows the heating of both the electrons and protons in the simulation for both 2D (left) and 1D (right)

<img src="/osunotebook/research/images/heating_r=0.5.png" style="display:block; width: 45%;"/> <img src="/osunotebook/research/images/heating_r=0.5_1D.png" style="display:block; width: 45%;"/>

Since the protons are heavier, they tend not to move as much and the heating is much slower. The Arber slope seems to be in between the electron slopes for the 1D and 2D cases, which makes sense because they averaged values from simulations in 1D and 2D to get their results. 


